# 繝舌ャ繧ｯ繧ｨ繝ｳ繝峨し繝ｼ繝舌・繧ｬ繧､繝・

縺薙・繧ｬ繧､繝峨・縲√・縺倥ａ縺ｦ MultiMediaWorker 縺ｮ繝舌ャ繧ｯ繧ｨ繝ｳ繝峨ｒ隗ｦ繧区婿蜷代￠縺ｫ縲√そ繝・ヨ繧｢繝・・縺ｮ蝓ｺ譛ｬ謇矩・→繧ｫ繧ｹ繧ｿ繝槭う繧ｺ譎ゅ・繝昴う繝ｳ繝医ｒ縺ｾ縺ｨ繧√◆繧ゅ・縺ｧ縺吶・xpress 繝吶・繧ｹ縺ｮ API 繧ｵ繝ｼ繝舌・縺ｨ OpenAI 繧貞茜逕ｨ縺励◆繝｡繝・ぅ繧｢繧ｨ繝ｼ繧ｸ繧ｧ繝ｳ繝医・讒区・繧堤炊隗｣縺励∫畑騾斐↓蜷医ｏ縺帙※隱ｿ謨ｴ縺ｧ縺阪ｋ繧医≧縺ｫ縺吶ｋ縺薙→繧堤岼謖・＠縺ｦ縺・∪縺吶・

---

## 1. 菴輔′蜍輔￥縺ｮ縺・

- `backend/src/server.js` 縺後お繝ｳ繝医Μ繝昴う繝ｳ繝医〒縺吶・ 
  - `.env.local` 繧定ｪｭ縺ｿ霎ｼ縺ｿ縲＾penAI 繧ｯ繝ｩ繧､繧｢繝ｳ繝医→ CLI 繝・・繝ｫ繧堤ｵ・∩蜷医ｏ縺帙◆ `MediaAgent` 繧堤函謌舌・ 
  - `MediaAgentServer`・・xpress 繧｢繝励Μ・峨ｒ襍ｷ蜍輔＠縲～/api/...` 縺ｮ繧ｨ繝ｳ繝峨・繧､繝ｳ繝医ｒ蜈ｬ髢九＠縺ｾ縺吶・
- 繧ｨ繝ｼ繧ｸ繧ｧ繝ｳ繝医・ **OpenAI Responses API** 繧剃ｽｿ縺｣縺ｦ螳溯｡檎畑繧ｳ繝槭Φ繝峨ｒ險育判縺励～ffmpeg` / `magick` / `exiftool` / `yt-dlp` 縺ｪ縺ｩ縺ｮ CLI 繧貞ｮ溯｡後＠縺ｦ邨先棡繧定ｿ斐＠縺ｾ縺吶・

---

## 2. 蛻ｩ逕ｨ蜑阪・貅門ｙ

1. **Node.js 18 莉･荳・* 繧偵う繝ｳ繧ｹ繝医・繝ｫ縺励∪縺吶・ 
2. **CLI 繝・・繝ｫ** 繧偵Ο繝ｼ繧ｫ繝ｫ縺ｫ逕ｨ諢上＠縲～PATH` 縺ｧ蜻ｼ縺ｳ蜃ｺ縺帙ｋ繧医≧縺ｫ縺励※縺翫″縺ｾ縺吶・ 
   - 蠢・・ `ffmpeg`, `magick` (ImageMagick), `exiftool`, `yt-dlp`  
3. **迺ｰ蠅・､画焚繝輔ぃ繧､繝ｫ** 繧剃ｽ懈・縺励∪縺吶・
   ```bash
   cp .env.example .env.local
   ```
   `.env.local` 縺ｫ OpenAI API 繧ｭ繝ｼ縺ｪ縺ｩ繧定ｨｭ螳壹＠縺ｾ縺吶・

---

## 3. 蛻晏屓繧ｻ繝・ヨ繧｢繝・・縺ｨ襍ｷ蜍墓焔鬆・

1. 萓晏ｭ倥ヱ繝・こ繝ｼ繧ｸ繧偵う繝ｳ繧ｹ繝医・繝ｫ縺励∪縺吶・
   ```bash
   npm install
   ```
2. 繝舌ャ繧ｯ繧ｨ繝ｳ繝峨し繝ｼ繝舌・繧定ｵｷ蜍輔＠縺ｾ縺吶・
   ```bash
   npm run dev:server
   ```
3. 繧ｵ繝ｼ繝舌・縺ｯ繝・ヵ繧ｩ繝ｫ繝医〒 `http://localhost:3001` 縺ｧ蠕・■蜿励￠縺ｾ縺吶ゅΟ繧ｰ縺ｫ縲窟gent server listening...縲阪′陦ｨ遉ｺ縺輔ｌ繧後・謌仙粥縺ｧ縺吶・
4. Web UI 繧ゆｽｵ逕ｨ縺吶ｋ蝣ｴ蜷医・縲∝挨繧ｿ繝ｼ繝溘リ繝ｫ縺ｧ繝輔Ο繝ｳ繝医お繝ｳ繝峨ｒ襍ｷ蜍輔＠縺ｾ縺吶・
   ```bash
   npm run dev:client
   ```
5. 蜍穂ｽ懃｢ｺ隱・ 繝悶Λ繧ｦ繧ｶ縺ｧ `http://localhost:5173` 繧帝幕縺阪√ち繧ｹ繧ｯ繧帝∽ｿ｡縺励※縺ｿ縺ｦ縺上□縺輔＞縲・LI 縺悟ｮ溯｡後〒縺阪↑縺・腸蠅・〒繧ゅ～Dry run` 繧呈怏蜉ｹ縺ｫ縺吶ｌ縺ｰ險育判縺ｮ縺ｿ遒ｺ隱阪〒縺阪∪縺吶・

---

## 4. API 縺ｮ菴ｿ縺・婿

| 繝｡繧ｽ繝・ラ | 繝代せ | 隱ｬ譏・|
| --- | --- | --- |
| `GET` | `/api/tools` | 蛻ｩ逕ｨ蜿ｯ閭ｽ縺ｪ CLI 繧ｳ繝槭Φ繝我ｸ隕ｧ繧貞叙蠕・|
| `POST` | `/api/tasks` | 繧ｿ繧ｹ繧ｯ縺ｨ蜈･蜉帙ヵ繧｡繧､繝ｫ繧帝∽ｿ｡縺励※繧ｳ繝槭Φ繝牙ｮ溯｡後ｒ萓晞ｼ |

`POST /api/tasks` 縺ｯ `multipart/form-data` 蠖｢蠑上〒縺吶よ怙菴朱剞縲～task` 繝輔ぅ繝ｼ繝ｫ繝峨↓繧・ｊ縺溘＞縺薙→繧定ｨ倩ｿｰ縺励∝ｿ・ｦ√↓蠢懊§縺ｦ `files` 繧呈ｷｻ莉倥＠縺ｾ縺吶ゅけ繧ｨ繝ｪ繝代Λ繝｡繝ｼ繧ｿ縺ｧ `dryRun=true` 繧・`debug=verbose` 縺ｪ縺ｩ繧呈欠螳壹☆繧九→謖ｯ繧玖・縺・ｒ螟画峩縺ｧ縺阪∪縺吶・

蠢懃ｭ比ｾ九ｄ隧ｳ邏ｰ縺ｪ JSON 讒矩縺ｯ `README.md` 縺ｨ `backend/docs/execution-overview.md` 縺ｫ險倩ｼ峨＠縺ｦ縺・∪縺吶・

---

## 5. 繧医￥菴ｿ縺・幕逋ｺ繧ｳ繝槭Φ繝・

- `npm test`  
  繝舌ャ繧ｯ繧ｨ繝ｳ繝峨・繝ｦ繝九ャ繝医ユ繧ｹ繝茨ｼ医・繝ｩ繝ｳ繝翫・蜻ｨ繧奇ｼ峨ｒ螳溯｡後＠縺ｾ縺吶・
- `npm run dev:server` / `npm run dev:client`  
  髢狗匱逕ｨ縺ｮ繧ｵ繝ｼ繝舌・繝ｻ繝輔Ο繝ｳ繝医お繝ｳ繝峨ｒ縺昴ｌ縺槭ｌ襍ｷ蜍輔＠縺ｾ縺吶・
- `npm run build:client`  
  繝輔Ο繝ｳ繝医お繝ｳ繝峨・譛ｬ逡ｪ繝薙Ν繝峨ｒ逕滓・縺励∪縺吶・

---

## 6. 繧ｫ繧ｹ繧ｿ繝槭う繧ｺ譁ｹ豕・

### 6.1 CLI 繝・・繝ｫ縺ｮ霑ｽ蜉繝ｻ螟画峩

1. `backend/src/agent/config/constants.js` 縺ｮ `DEFAULT_TOOL_DEFINITIONS` 縺ｫ譁ｰ縺励＞繝・・繝ｫ繧定ｿｽ蜉縺励∪縺吶・
2. 霑ｽ蜉縺励◆繧ｳ繝槭Φ繝峨′螳滄圀縺ｫ螳溯｡後〒縺阪ｋ繧医≧縲√し繝ｼ繝舌・繝槭す繝ｳ縺ｫ CLI 繧偵う繝ｳ繧ｹ繝医・繝ｫ縺・`PATH` 縺ｫ逋ｻ骭ｲ縺励∪縺吶・
3. 蠢・ｦ√〒縺ゅｌ縺ｰ縲√ヵ繝ｭ繝ｳ繝医お繝ｳ繝牙・・・App.tsx`・峨・隱ｬ譏取枚繧・UI 繧呈峩譁ｰ縺励∪縺吶・

### 6.2 OpenAI 縺ｮ繝｢繝・Ν繧・・繝ｭ繝ｳ繝励ヨ繧定ｪｿ謨ｴ縺吶ｋ

- `.env.local` 縺ｮ `OPENAI_MODEL` 繧貞､画峩縺吶ｋ縺ｨ縲√し繝ｼ繝舌・襍ｷ蜍墓凾縺ｫ菴ｿ縺・Δ繝・Ν縺悟・繧頑崛繧上ｊ縺ｾ縺吶・
- 繧医ｊ隧ｳ邏ｰ縺ｪ繝励Ο繝ｳ繝励ヨ蛻ｶ蠕｡繧定｡後＞縺溘＞蝣ｴ蜷医・ `backend/src/agent/planning/PromptBuilder.js` 繧・`PlanValidator.js` 繧堤ｷｨ髮・＠縺ｾ縺吶・Sdoc 繧貞盾閠・↓縺吶ｋ縺ｨ螳牙・縺ｫ螟画峩縺ｧ縺阪∪縺吶・

### 6.3 螳溯｡後ち繧､繝繧｢繧ｦ繝医ｄ蜃ｺ蜉帛・繝・ぅ繝ｬ繧ｯ繝医Μ繧貞､峨∴繧・

- 繧ｿ繧､繝繧｢繧ｦ繝医↑縺ｩ縺ｮ螳溯｡後が繝励す繝ｧ繝ｳ縺ｯ `createMediaAgent` 蜻ｼ縺ｳ蜃ｺ縺玲凾縺ｫ謖・ｮ壹〒縺阪∪縺呻ｼ・backend/src/server.js` 繧貞盾辣ｧ・峨ゆｾ・
  ```js
  const agent = createMediaAgent(openAIClient, {
    toolRegistry,
    executorOptions: { timeoutMs: 10 * 60 * 1000 } // 10 蛻・↓蟒ｶ髟ｷ
  });
  ```
- 蜃ｺ蜉帛・繝・ぅ繝ｬ繧ｯ繝医Μ繧貞､画峩縺励◆縺・ｴ蜷医・ `server.js` 蜀・・ `PUBLIC_ROOT` 繧・`GENERATED_ROOT` 縺ｮ險育ｮ励ｒ邱ｨ髮・＠縺ｾ縺吶・ 
  UI 縺九ｉ繝繧ｦ繝ｳ繝ｭ繝ｼ繝峨〒縺阪ｋ繧医≧縺ｫ縺励◆縺・ｴ蜷医・縲∝粋繧上○縺ｦ `public/` 莉･荳九・讒区・繧りｪｿ謨ｴ縺励※縺上□縺輔＞縲・

### 6.4 繧ｨ繝ｳ繝峨・繧､繝ｳ繝医ｒ蠅励ｄ縺・

- `MediaAgentServer` (`backend/src/server/MediaAgentServer.js`) 縺ｫ譁ｰ縺励＞繝ｫ繝ｼ繝医ｒ霑ｽ蜉縺ｧ縺阪∪縺吶ＡconfigureRoutes` 繝｡繧ｽ繝・ラ繧貞盾閠・↓縲～this.app.get(...)` 縺ｪ縺ｩ繧定ｿｽ險倥＠縺ｦ縺上□縺輔＞縲・
- 繧ｻ繧ｭ繝･繝ｪ繝・ぅ繧・ｪ榊庄繧貞ｰ主・縺励◆縺・ｴ蜷医・ Express 縺ｮ繝溘ラ繝ｫ繧ｦ繧ｧ繧｢・・configureMiddleware`・峨↓蜃ｦ逅・ｒ蟾ｮ縺苓ｾｼ繧縺ｨ邂｡逅・＠繧・☆縺上↑繧翫∪縺吶・

---

## 7. 繝医Λ繝悶Ν繧ｷ繝･繝ｼ繝・ぅ繝ｳ繧ｰ

| 逞・憾 | 蟇ｾ蠢懃ｭ・|
| --- | --- |
| `ffmpeg` 縺瑚ｦ九▽縺九ｉ縺ｪ縺・| CLI 繧偵う繝ｳ繧ｹ繝医・繝ｫ縺励√さ繝槭Φ繝峨Λ繧､繝ｳ縺九ｉ逶ｴ謗･ `ffmpeg -version` 縺悟ｮ溯｡後〒縺阪ｋ縺薙→繧堤｢ｺ隱阪＠縺ｦ縺上□縺輔＞縲・|
| `OPENAI_API_KEY` 縺瑚ｨｭ螳壹＆繧後※縺・↑縺・→隴ｦ蜻・| `.env.local` 縺ｫ繧ｭ繝ｼ繧定ｨ倩ｿｰ縺励√し繝ｼ繝舌・繧貞・襍ｷ蜍輔＠縺ｾ縺吶・|
| Plan 逕滓・縺ｧ螟ｱ謨励☆繧・| `debug` 繧ｪ繝励す繝ｧ繝ｳ繧偵が繝ｳ縺ｫ縺励※ `responseText` 繧・`rawPlan` 繧堤｢ｺ隱阪ＡPlanValidator` 縺ｫ蠑輔▲縺九°縺｣縺溷ｴ蜷医・繧ｨ繝ｩ繝ｼ繝｡繝・そ繝ｼ繧ｸ繧貞盾辣ｧ縺励｝rompt 縺・tool 螳夂ｾｩ繧定ｪｿ謨ｴ縺励∪縺吶・|
| 螳溯｡後′繧ｿ繧､繝繧｢繧ｦ繝医☆繧・| `executorOptions.timeoutMs` 繧貞ｻｶ髟ｷ縲√∪縺溘・繧ｳ繝槭Φ繝峨′髟ｷ譎る俣縺九°繧峨↑縺・ｈ縺・ｼ墓焚繧定ｪｿ謨ｴ縺励∪縺吶・|

---

## 8. 蜿り・ラ繧ｭ繝･繝｡繝ｳ繝・

- `backend/docs/execution-overview.md` 窶ｦ 繝舌ャ繧ｯ繧ｨ繝ｳ繝牙・驛ｨ縺ｮ繝輔ぉ繝ｼ繧ｺ讒矩繧呈凾邉ｻ蛻励〒遒ｺ隱阪〒縺阪∪縺吶・ 
- `frontend/docs/ui-execution-overview.md` 窶ｦ UI 縺九ｉ縺ｮ蜻ｼ縺ｳ蜃ｺ縺励ヵ繝ｭ繝ｼ繧定ｿｽ縺・◆縺・→縺阪↓蜿ら・縺励※縺上□縺輔＞縲・ 
- `README.md` 窶ｦ 繝励Ο繧ｸ繧ｧ繧ｯ繝亥・菴薙・繧ｻ繝・ヨ繧｢繝・・繧・茜逕ｨ繧ｳ繝槭Φ繝峨ｒ荳隕ｧ縺励※縺・∪縺吶・

縺薙・繧ｬ繧､繝峨ｒ蜃ｺ逋ｺ轤ｹ縺ｫ縲∝ｿ・ｦ√↑邂・園縺ｮ繧ｽ繝ｼ繧ｹ繧ｳ繝ｼ繝峨∈鬟帙・縺ｪ縺後ｉ閾ｪ蛻・・逕ｨ騾斐↓蜷医ｏ縺帙※繧ｫ繧ｹ繧ｿ繝槭う繧ｺ縺励※縺ｿ縺ｦ縺上□縺輔＞縲・

